# ИДЗ 4. Система заказов по покупку билетов
## Выполнила: Шиверских Елизавета Анатольевна БПИ223

### Перед началом работы
Необходимо установить Docker и ввести следующую команду в терминале:
```bash
docker-compose up -d
```
Это команда запустит контейнеры с двумя микросервисами и двумя базами данных, накатив миграции на них.

**NB:** Во время первого запуска образы сервисов могут собираться продолжительное время.

### Описание сервисов
1. **Orders-service** - сервис, отвечающий за создание заказов и их обработку.
2. **User-service** - сервис, отвечающий за регистрацию и авторизацию пользователей.

### Описание API
1. **Orders-service**:
    - POST /orders/create - создание заказа <span style="color:forestgreen;">(требуется токен)</span> <br> В процессе выполенния запроса заказ добавляется в бд *orders*<br> Пример тела запроса:
        ```
        {
            "station_to": "Moscow",
            "station_from": "Krasnoyarsk"
        }
        ```
      <br> Присутствует проверка на пустоту и отсутствия поля. <br> Присутствует проверка на существование станций в базе данных. <br> При отсутствии токена возвращается <u>ошибка 403</u>. <br> При инвалидном токене возвращается <u>ошибка 401</u>. <br> При успешном создании заказа возвращается <u>201 и id созданного заказа</u>.
    - GET /orders/getallstations - получение всех станций
      <br> При успешном нахождения станций возвращается <u>200 и список станций</u>.
    - GET /orders/getinfo?id={id} - получение информации о заказе по id <span style="color:forestgreen;">(требуется токен)</span>
      <br> При отсутствии токена возвращается <u>ошибка 403</u>. <br> При инвалидном токене возвращается <u>ошибка 401</u>. <br> При успешном нахождения заказа возвращается <u>200 и заказ</u>.
2. **User-service**:
    - POST /users/register - регистрация пользователя <br> В процессе выполенния запроса юзер добавляется в бд *users* <br> Пример тела запроса:
        ```
        {
            "email": "a@b.c",
            "nickname": "test",
            "password": "Xx123!321"
        }
        ```
      <br> Присутствует проверка на пустоту и отсутствия поля. Если какое-то поле не найдено, то будет <u>ошибка 406</u>.<br> Присутствует проверка на существование юзера с такой почтой и никнеймом в базе данных. Если пользователь найден, то будет <u>ошибка 406</u>. <br> При успешном создании юзера возвращается <u>201 и строка, сообщающая об этом</u>.
    
    - POST /users/authorize - авторизация пользователя <span style="color:forestgreen;">(требуется токен)</span> <br> В процессе выполенния запроса создается сессия и добавляется в бд *sessions* <br> Пример тела запроса:
        ```
        {
            "email": "a@b.c",
            "password": "Xx123!321"
        }
        ```
      <br> При отсутствии токена возвращается <u>ошибка 403</u>. <br> При инвалидном токене возвращается <u>ошибка 401</u>.
      <br> Присутствует проверка на пустоту и отсутствия поля. Если какое-то поле не найдено, то будет <u>ошибка 406</u>.<br> Присутствует проверка на существование юзера с такой почтой в базе данных. Если пользователь не найден, то будет <u>ошибка 406</u>. <br> Присутствует проверка на корректность пароля. Если пароль неверен, то будет <u>ошибка 404</u>. <br> При успешном создании юзера возвращается <u>200 и JSON-объект, содержащий токен юзера</u>.
   - GET /users/me - получение информации о пользователе <span style="color:forestgreen;">(требуется токен)</span> 
      <br> При отсутствии токена возвращается <u>ошибка 403</u>. <br> При инвалидном токене возвращается <u>ошибка 401</u>. <br> В ответ возвращается <u>200 и информация о пользователе</u>.
      
### Внутренний сервис
В сервисе создания заказов присутствует внутренний сервис *OrderProcesingService*, который извлекает заказ в статутсе проверки и рандомно присваивает ему либо статус "Подтвержден", либо "Отклонен".